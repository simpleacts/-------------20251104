# ビルドワークフローとエラー修正プロセス

## 概要

このドキュメントでは、ビルド実行からエラー修正までの一連のワークフローを説明します。

## ビルド実行方法

### 推奨: エラーチェック付きビルド

```bash
build-with-check.bat
```

このバッチファイルは以下を自動実行します：
1. 実行ポリシーの設定（確認プロンプトで「Y」を選択）
2. TypeScriptの構文チェック
3. SQLファイルの存在確認
4. npm install（依存関係のインストール）
5. npm run build（アプリケーションのビルド）
6. ビルド成功時: PHP開発サーバーの自動起動

## エラー修正ワークフロー

### ステップ1: ビルド実行

```bash
build-with-check.bat
```

### ステップ2: エラー検出時の対応

エラーが検出された場合、以下のプロンプトが表示されます：

```
エラーを修正しますか？ (Y/N)
  Y: エラー内容をAIに送信して修正を依頼します
  N: エラーを無視してビルドを続行します
```

### ステップ3: AI修正の依頼

「Y」を選択した場合、エラーログファイルの内容が表示されます。

**AIへの依頼方法:**
```
「build-with-check.batを実行して、検出されたエラーをすべて修正してください。
エラーログは build-errors.log に保存されています。」
```

または、エラー内容を直接共有：
```
「以下のエラーを修正してください:
[エラー内容を貼り付け]」
```

### ステップ4: 修正後の再ビルド

修正が完了したら、再度ビルドを実行：
```bash
build-with-check.bat
```

このプロセスを、エラーがなくなるまで繰り返します。

## 自動ループ機能

`build-with-check.bat`には自動ループ機能が組み込まれています：

- **最大リトライ回数**: 1回
- **動作**: エラー検出時に自動修正を試み、修正後1回だけ自動的に再ビルドを実行
- **2回目以降**: エラーが残っている場合は、手動での修正依頼が必要

### 自動ループの流れ

1. ビルド実行
2. エラー検出
3. 自動修正を試みる
4. 自動的に1回だけ再ビルド
5. エラーが残っている場合: 手動での修正依頼が必要

## エラーログファイル

### build-errors.log
- TypeScriptのエラー
- ビルドエラー
- その他のコンパイルエラー

### build-output.log
- ビルド出力の全体ログ
- エラー発生時に自動生成

## 自動修正機能

`scripts/auto-fix-errors.ps1`が以下のエラーを自動修正します：
- インポートエラーの一部
- 型エラーの検出と修正候補の提示

## ビルド成功時の動作

ビルドが成功した場合：
1. 一時ファイル（build-errors.log, build-output.log）を自動削除
2. PHP開発サーバーを自動起動（別ウィンドウ）
3. サーバーURL: http://localhost:8080

## サーバーの停止方法

- サーバーウィンドウを閉じる（×ボタン）
- または、サーバーウィンドウで Ctrl+C を押す

どちらの方法でもサーバーは正常に停止します。

## AIへの修正依頼プロンプト例

### パターン1: エラーログファイルを指定
```
「build-with-check.batを実行して、build-errors.logのエラーを修正してください」
```

### パターン2: 特定のエラーを指定
```
「TypeScriptのエラーを修正してください。エラーメッセージは以下です:
[エラー内容]」
```

### パターン3: すべてのエラーを修正
```
「build-with-check.batを実行して、検出されたすべてのエラーを修正してください」
```

## 注意事項

1. **ビルド前にサーバーを停止**: PHP開発サーバーが起動している場合は、必ず停止してからビルドしてください
2. **エラーログの確認**: エラーが発生した場合、`build-errors.log`を確認してください
3. **繰り返しビルド**: エラー修正後は、必ず再度ビルドを実行して確認してください
4. **自動修正の限界**: 自動修正できないエラーは、AIに修正を依頼してください
5. **自動ループの制限**: 自動ループは1回までです。2回目以降は手動での修正が必要です

